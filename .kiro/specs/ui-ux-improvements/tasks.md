# 実装計画：UI/UX改善

## タスクリスト

- [x] 1. 点数表示フォーマッターの実装





  - 子のツモ、親のツモ、ロンの各ケースに対応した点数フォーマット関数を実装
  - FormattedScore型とformatScore関数を作成
  - _要件: 11.1, 11.2, 11.4, 11.5_

- [ ]* 1.1 点数フォーマッターのプロパティテストを作成
  - **プロパティ2: 点数フォーマットの正確性**
  - **検証要件: 11.1, 11.2, 11.4, 11.5**

- [x] 2. 牌ソート機能の実装





  - 萬子→筒子→索子→風牌→役牌の順序でソートする関数を実装
  - 同種牌は数字の昇順、赤ドラは通常の5と同じ位置に配置
  - sortTiles関数を作成
  - _要件: 12.1, 12.2, 12.3, 12.4, 12.5_

- [ ]* 2.1 牌ソート機能のプロパティテストを作成
  - **プロパティ3: 牌ソート順序の正確性**
  - **検証要件: 12.1, 12.2, 12.3, 12.4, 12.5**

- [x] 3. HandDisplayコンポーネントの更新





  - 牌ソート機能を統合して手牌を整列表示
  - 点数フォーマッターを使用して点数を適切に表示
  - _要件: 11.1, 11.2, 12.1_

- [x] 4. 状態バッジコンポーネントの実装




  - StatusBadgeコンポーネントを作成
  - 立直、門前、鳴きありなどの状態を視覚的に表示
  - 色とアイコンで状態を識別可能にする
  - _要件: 13.1, 13.2, 13.3, 13.4, 13.5_

- [ ]* 4.1 状態バッジのプロパティテストを作成
  - **プロパティ4: 状態バッジの表示**
  - **検証要件: 13.1, 13.2, 13.3, 13.4, 13.5**

- [x] 5. HandDisplayに状態バッジを統合





  - StatusBadgeコンポーネントをHandDisplayに追加
  - 手牌の状態に応じて適切なバッジを表示
  - _要件: 13.1, 13.3_

- [x] 6. 解説生成機能の実装





  - Explanation型とgenerateExplanation関数を作成
  - 符の内訳、役の一覧、計算過程を生成
  - _要件: 2.1, 2.2, 2.3_

- [ ]* 6.1 解説生成のプロパティテストを作成
  - **プロパティ5: 解説データの完全性**
  - **検証要件: 2.1, 2.2, 2.3**

- [x] 7. ExplanationPanelコンポーネントの実装





  - 解説を表示するモーダルコンポーネントを作成
  - 符の内訳、役、計算過程をわかりやすく表示
  - スクロール可能な領域で長い解説に対応
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 8. ResultModalに解説表示を統合




  - ExplanationPanelをResultModalに統合
  - 不正解時は自動表示、正解時は「解説を見る」ボタンで表示
  - _要件: 2.1, 2.4_

- [x] 9. 拡張統計情報の実装





  - ExtendedStatistics型を定義
  - 難易度別統計、最近10問、連続正解数、学習時間を計算
  - calculateExtendedStatistics関数を作成
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [ ]* 9.1 統計計算のプロパティテストを作成
  - **プロパティ6: 統計データの正確性**
  - **検証要件: 3.1, 3.2, 3.3, 3.4**

- [x] 10. DetailedStatisticsコンポーネントの実装





  - 詳細統計を表示するコンポーネントを作成
  - 難易度別正解率、最近10問、連続正解数、学習時間を表示
  - アニメーション付きで統計の変化を表示
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 11. QuizContextに統計機能を統合





  - ExtendedStatisticsをQuizStateに追加
  - 統計計算ロジックをQuizContextに統合
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [x] 12. キーボードショートカット管理の実装





  - KeyboardShortcut型とuseKeyboardShortcutsフックを作成
  - 数字キー、Enter、Space、Escapeキーに対応
  - _要件: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ]* 12.1 キーボードショートカットのプロパティテストを作成
  - **プロパティ7: キーボードショートカットの動作**
  - **検証要件: 4.1, 4.2, 4.3, 4.4**

- [x] 13. QuizScreenにキーボードショートカットを統合





  - useKeyboardShortcutsフックをQuizScreenで使用
  - 各キーに対応するアクションを設定
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [x] 14. アニメーション制御の実装



  - AnimationSettings型とuseAnimationSettingsフックを作成
  - prefers-reduced-motionの検出と対応
  - アニメーション速度の設定機能
  - _要件: 1.1, 1.2, 1.5, 6.5, 8.1, 8.4_

- [ ]* 14.1 アニメーション制御のプロパティテストを作成
  - **プロパティ10: アニメーション設定の尊重**
  - **検証要件: 6.5, 8.4**

- [x] 15. アニメーション効果の追加





  - 正解・不正解時のアニメーションクラスを追加
  - 統計更新時のアニメーション効果を追加
  - ローディング状態のアニメーションを追加
  - _要件: 1.1, 1.2, 1.5, 3.5_

- [ ]* 15.1 アニメーション効果のプロパティテストを作成
  - **プロパティ1: アニメーション効果の適用**
  - **検証要件: 1.1, 1.2, 1.5, 3.5**

- [x] 16. UI設定の実装





  - UISettings型を定義
  - アニメーション、音声、表示設定を管理
  - ローカルストレージへの保存・読み込み
  - _要件: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ]* 16.1 設定永続化のプロパティテストを作成
  - **プロパティ11: 設定の永続化（ラウンドトリップ）**
  - **検証要件: 8.5**

- [x] 17. SettingsPanelの拡張




  - アニメーション速度、音声、フォントサイズの設定を追加
  - 設定変更の即座反映
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [x] 18. アクセシビリティの向上





  - すべてのインタラクティブ要素にARIAラベルを追加
  - フォーカス状態の視覚的表示を改善
  - 色以外の情報提供（アイコン、テキスト）を追加
  - _要件: 6.1, 6.2, 6.3_

- [ ]* 18.1 ARIAラベルのプロパティテストを作成
  - **プロパティ8: ARIAラベルの存在**
  - **検証要件: 6.1**

- [ ]* 18.2 色以外の情報提供のプロパティテストを作成
  - **プロパティ9: 色以外の情報提供**
  - **検証要件: 6.3**

- [x] 19. エラーハンドリングの改善





  - ErrorInfo型とErrorHandlerクラスを実装
  - 具体的なエラーメッセージと対処法を提供
  - エラーの自動記録機能
  - 5秒後の自動消去機能
  - _要件: 9.1, 9.2, 9.3, 9.5_

- [ ]* 19.1 エラーメッセージのプロパティテストを作成
  - **プロパティ12: エラーメッセージの完全性**
  - **検証要件: 9.1, 9.2**

- [ ]* 19.2 エラー記録のプロパティテストを作成
  - **プロパティ13: エラーの自動記録**
  - **検証要件: 9.3**

- [x] 20. ErrorAlertコンポーネントの更新





  - 新しいエラーハンドリング機能を統合
  - 再試行オプションの追加（ネットワークエラー時）
  - _要件: 9.1, 9.2, 9.4, 9.5_

- [x] 21. ツールチップ機能の実装





  - TooltipConfig型とTooltipコンポーネントを作成
  - ホバー時に補足情報を表示
  - 位置調整とディレイ機能
  - _要件: 10.3_

- [x] 22. 主要UI要素にツールチップを追加





  - 設定項目、統計情報、ボタンにツールチップを追加
  - わかりやすい説明文を提供
  - _要件: 10.3_

- [x] 23. チュートリアル機能の実装





  - TutorialStep型とTutorialOverlayコンポーネントを作成
  - ステップバイステップのガイド表示
  - スキップ機能と完了状態の保存
  - _要件: 10.1, 10.4, 10.5_

- [ ]* 23.1 チュートリアル状態永続化のプロパティテストを作成
  - **プロパティ14: チュートリアル状態の永続化**
  - **検証要件: 10.5**

- [x] 24. 初回訪問時のチュートリアル表示





  - 初回訪問を検出してチュートリアルを表示
  - チュートリアル完了後は表示しない
  - _要件: 10.1, 10.5_

- [x] 25. ヘルプ機能の実装





  - ヘルプボタンとヘルプモーダルを作成
  - 各機能の説明を表示
  - _要件: 10.2_

- [x] 26. レスポンシブデザインの最適化





  - モバイル端末用のスタイル調整
  - タブレット用の中間レイアウト
  - 横向き表示の最適化
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 27. AnswerSelectorの視覚的フィードバック強化





  - ホバー時のフィードバック改善
  - 選択時のアニメーション追加
  - _要件: 1.3, 1.4_

- [x] 28. 最終チェックポイント - すべてのテストが通ることを確認





  - すべてのテストを実行して通過を確認
  - 問題があれば修正
  - ユーザーに質問があれば確認
